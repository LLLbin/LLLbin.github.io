---
layout:     post                    
title:      Linux - Vim - common - instruction          
subtitle:   那些Vim上常用的快捷键🍗
date:       2020-06-28            
author:     Lebin                     
header-img: img/post-bg-Vimrc.jpg
catalog: true                       
tags:                               
    - Linux
    - Vim
---

## 启动Vim
```
vim + file            从文件的末尾开始
vim -c cmd file	      在打开文件前，先执行指定的命令；
vim -r file	          恢复上次异常退出的文件；
vim -R file	          以只读的方式打开文件，但可以强制保存；
vim -M file	          以只读的方式打开文件，不可以强制保存；
vim --remote file	  用已有的vim进程打开指定的文件。如果你不想启用多个vim会话，这个很有用。
```

## 模式切换
```
正常模式        其他模式下，按下Esc进入, 正常模式一般用于浏览文件，也包括一些复制、粘贴、删除等操作
命令模式        在正常模式中，按下：（冒号）键，会进入命令模式
可视模式        在正常模式按下v等可以进入可视模式。
插入模式        在正常模式中按下i, I, a, A, s, S等进入插入模式
```

## 文档操作
```
:e file	                关闭当前编辑的文件，并开启新的文件。 如果对当前文件的修改未保存，vi会警告。
:e! file	              放弃对当前文件的修改，编辑新的文件。
:e+file	                开始新的文件，并从文件尾开始编辑。
:enew	                  编译一个未命名的新文档。(CTRL-W n)
:e	                    重新加载当前文档。
:e!	                    重新加载当前文档，并丢弃已做的改动。
:e#或ctrl+^	            回到刚才编辑的文件，很实用。
:f或ctrl+g	            显示文档名，是否修改，和光标位置。
:f filename	            改变编辑的文件名，这时再保存相当于另存为。
:w	                    保存修改。
:wq	                    保存并退出。
:x	                    保存并退出。
:n1,n2w filename	      选择性保存从某n1行到另n2行的内容。
:saveas newfilename	    另存为
:q[uit]                 退出当前窗口。(CTRL-W q或CTRL-W CTRL-Q)
:browse e               会打开一个文件浏览器让你选择要编辑的文件。 用browse打开的起始目录可以由browsedir来设置：
:set browsedir=last     用上次访问过的目录（默认）；
:set browsedir=buffer   用当前文件所在目录；
:set browsedir=current  用当前工作目录；
:Sex                    水平分割一个窗口，浏览文件系统；
:Vex                    垂直分割一个窗口，浏览文件系统；
gf	                    打开以光标所在字符串为文件名的文件。
ZZ	                    保存并退出。
```

## 光标移动
##### 1.基本移动
```
0或^          当前行行首
$             当前行行尾
gg            第一行
G             最后一行
n|            第n列
ngg           第n行
nG            第n行
:n            第n行

hjkl(方向键)   左下上右
gj            移动到一段内的下一行；
gk            移动到一段内的上一行；
+或Enter      把光标移至下一行第一个非空白字符。
-             把光标移至上一行第一个非空白字符。
w             前移一个单词，光标停在下一个单词开头；
fc            把光标移到同一行的下一个c字符处
Fc            把光标移到同一行的上一个c字符处
;             配合f & t使用，重复一次
,             配合f & t使用，反向重复一次

(以上均可搭配n使用)
```

##### 2.翻屏
```
ctrl+f      下翻一屏。
ctrl+b      上翻一屏。
ctrl+d      下翻半屏。
ctrl+u      上翻半屏。
n%          到文件n%的位置。
zz          将当前行移动到屏幕中央。
zt          将当前行移动到屏幕顶端。
zb          将当前行移动到屏幕底端。
```

## 插入文本
##### 1.基本插入
```
i       在光标前插入；（小技巧，8i=<Esc> → 插入8个=当作分界线）
I       在当前行第一个非空字符前插入；
a       在光标后插入；
A       在当前行最后插入；
o       在下面新建一行插入；
O       在上面新建一行插入；
s       删除当前字母，进入插入模式
S       删除当前行，进入插入模式

:r filename       在当前位置插入另一个文件的内容。
:[n]r filename    在第n行插入另一个文件的内容。
:r !date          在光标处插入当前日期与时间。
:r !command       可以将其它shell命令的输出插入当前文档。
```

##### 2.改写插入
```
c[n]w       改写光标后1(n)个词。
c[n]l       改写光标后n个字母。
c[n]h       改写光标前n个字母。
[n]cc       删除当前[n]行后插入。
[n]s        相当于c[n]l。
[n]S        相当于[n]cc。
```

## 可视模式
```
y           复制在可视模式下选中的文本。
d           删除（剪切）在可视模式下选中的文本。
p           光标处直接粘贴
P           光标前直接粘贴
```

## 剪切删除复制粘贴
```
[n]x        删除（剪切）光标右边n个字符
[n]X        删除（剪切）光标左边n个字符
[n]dd       删除（剪切）1(n)行。
d[n]w       删除（剪切）1(n)个单词
d0          删除（剪切）当前位置到行首的内容
d$(D)       删除（剪切）当前位置到行首的内容
:m,nd       删除（剪切）m行到n行的内容。
dgg:        删除（剪切）光标以上的所有行。
dG:         删除（剪切）光标以下的所有行。

[n]yy       复制1(n)行。
y[n]w       复制一(n)个词。
y0          从光标当前位置复制到行首。
y$          从光标当前位置复制到行尾。
:m,ny       复制m行到n行的内容。
ygg:        复制光标以上的所有行。
yG:         复制光标以下的所有行。

p           在光标之后粘贴。
P           在光标之前粘贴。
```

## 文本对象
```
aw     一词
as     一句。
ap     一段。
ab     一块（包含在圆括号中的）。

(y, d, c, v都可以跟文本对象。)
```

## 寄存器（粘贴板）
```
a-z       可以用作寄存器名。"ayy把当前行的内容放入a寄存器。
A-Z       在寄存器中追加内容。 "Ayy把当前行的内容追加到a寄存器中。
:reg      显示所有寄存器的内容。
""        不加寄存器索引时，默认使用的寄存器。
"*        当前选择缓冲区，"*yy把当前行的内容放入当前选择缓冲区。
"+        系统剪贴板。"+yy把当前行的内容放入系统剪贴板。
```

## 查找与替换
##### 1.查找
```
/s       在后面的文本中查找s。
?s       在前面的文本中查找s。
n        向后查找下一个。
N        向前查找下一个。
\c       大小写不敏感
\C       大小写敏感
*和#     查找光标所在单词
```
##### 2.替换
```
:s/old/new             用new替换当前行第一个old。
:s/old/new/g           用new替换当前行所有的old。
:n1,n2s/old/new/g      用new替换文件n1行到n2行所有的old。
:%s/old/new/g          用new替换文件中所有的old。
:%s/^/xxx/g            在每一行的行首插入xxx，^表示行首。
:%s/$/xxx/g            在每一行的行尾插入xxx，$表示行尾。

i 表示大小写不敏感， %s/foo/bar/i
I 表示大小写敏感     %s/foo/bar/I
c 表示需要确认       %s/foo/bar/gc
```

##### （高级查找替换用可用正则表达式）

## 排版
##### 1.基本排版
```
>>           光标所在行会缩进。
n >>         光标以下的n行会缩进。
<<           光标所在行会缩出。
n <<         光标以下的n行会缩出。
n =          调整n行代码的缩排。
gg=G         重排全文（赞）
(在可视模式下，选择要调整的代码块，按=，代码会按书写规则缩排好。)

:ce(nter)    本行文字居中
:le(ft)      本行文字靠左
:ri(ght)     本行文字靠右
J            拼接当前行和下一行
gJ           同 J ，不过合并后不留空格c
```

##### 2.拼写检查
```
:set spell         开启拼写检查功能
:set nospell       关闭拼写检查功能
]s                 移到下一个拼写错误的单词
[s                 移到上一个拼写错误的单词
z=                 显示一个有关拼写错误单词的列表，可从中选择
zg                 告诉拼写检查器该单词是拼写正确的
zw                 告诉拼写检查器该单词是拼写错误的
```

##### 3.统计字数
```
g ^g        统计文档字符数，行数。中文字数 = 字符数 - 行数
```

## 编辑多个文件
##### 1.一次编辑多个文件
```
:n(ext)            编辑下一个文件。
:2n                编辑下2个文件。
:previous或:N      编辑上一个文件。
:wnext             保存当前文件，并编辑下一个文件。
:wprevious         保存当前文件，并编辑上一个文件。
:args              显示文件列表。
:n filenames       指定新的文件列表。
:args filenames    指定新的文件列表。
vi -o filenames    在水平分割的多个窗口中编辑多个文件。
vi -O filenames    在垂直分割的多个窗口中编辑多个文件。
```
##### 2.多标签编辑
```
vim -p files         打开多个文件，每个文件占用一个标签页。
:tabe   name         如果加文件名，就在新的标签中打开这个文件， 否则打开一个空缓冲区。
^w gf                在新的标签页里打开光标下路径指定的文件。
:tabn                切换到下一个标签。(Control + PageDown)
:tabp                切换到上一个标签。(Control + PageUp)
[n] gt               切换到下一个标签。如果前面加了 n ， 就切换到第n个标签。
:tab split           将当前缓冲区的内容在新页签中打开。
:tabc[lose]          关闭当前的标签页。
:tabo[nly]           关闭其它的标签页。
:tabs                列出所有的标签页和它们包含的窗口。
:tabm[ove] [N]       移动标签页，移动到第N个标签页之后。
```

##### 3.缓冲区
```
:buffers或:ls或:files     显示缓冲区列表。
ctrl+^                    在最近两个缓冲区间切换。
:bn                       下一个缓冲区。
:bp                       上一个缓冲区。
:bl                       最后一个缓冲区。
:b[n]或:[n]b              切换到第n个缓冲区。
:nbw(ipeout)              彻底删除第n个缓冲区。
:ba[ll]                   把所有的缓冲区在当前页中打开，每个缓冲区占一个窗口。
```

## 分屏编辑
```
vim -o file1 file2     水平分割窗口，同时打开file1和file2
vim -O file1 file2     垂直分割窗口，同时打开file1和file2
```

##### 1.水平分割
```
:split(:sp)        把当前窗口水平分割成两个窗口。(CTRL-W s)
:split filename    水平分割窗口，并在新窗口中显示另一个文件。
:nsplit(:nsp)      水平分割出一个n行高的窗口。
:[N]new            水平分割出一个N行高的窗口，并编辑一个新文件。
```

##### 2.垂直分割
```
:vsplit(:vsp)      把当前窗口垂直分割成两个窗口。(CTRL-W v)
:vsplit filename   垂直分割窗口，并在新窗口中显示另一个文件。
:nvsplit(:nsp)     垂直分割出一个n行高的窗口。
:[N]vne[w]         垂直分割出一个N行高的窗口，并编辑一个新文件。
```

##### 3.切换和移动窗口
```
ctrl+w w           切换到下一个窗口。
ctrl+w p           切换到前一个窗口。
ctrl+w h(l,j,k)    切换到左（右，下，上）的窗口。
ctrl+w H(L,K,J)    将当前窗口移动到最左（右、上、下）面。
ctrl+w r           旋转窗口的位置。
ctrl+w T           将当前的窗口移动到新的标签页上。
```

##### 4.调整窗口大小
```
ctrl+w +        当前窗口增高一行。也可以用n增高n行。
ctrl+w -        当前窗口减小一行。也可以用n减小n行。
ctrl+w _        当前窗口尽可能的高。也可以用n设定行数。
ctrl+w =        所有窗口同样高度。
ctrl+w <        当前窗口减少一列。也可以用n减少n列。
ctrl+w >        当前窗口增宽一列。也可以用n增宽n列。
ctrl+w |        当前窗口尽可能的宽。也可以用n设定列数。
```

##### 5.关闭子窗口
```
:qall            关闭所有窗口
:wall            保存所有修改过的窗口。
:wqall           保存并关闭所有窗口
:only            只保留当前窗口，关闭其它窗口。(CTRL-W o)
:close           关闭当前窗口，CTRL-W c能实现同样的功能。 (:q或:x)
```


## 快速编辑
##### 1.替换
```
r      替换光标处的字符，同样支持汉字。
R      进入替换模式，按esc回到正常模式。
```

##### 2.撤销与重做
```
U               取消当前行中所有的改动。
[n] u:          取消一(n)个改动。
:undolist       你的撤销历史。
ctrl+r          重做撤销。
:earlier 4m     回到4分钟前
:later 55s      前进55秒
```

##### 3.宏
```
.         重复上一个编辑动作
qa        开始录制宏a（键盘操作记录）
q         停止录制
@a        播放宏a
```

## 编辑特殊文件
##### 1.文件加密
```
vim -x file      开始编辑一个加密的文件。
:X               为当前文件设置密码。
:set key =       去除文件的密码。
```

##### 2.文件的编码
```
:e ++enc=utf8 filename  让vim用utf-8的编码打开这个文件。
:w ++enc=gbk            不管当前文件什么编码，把它转存成gbk编码。
:set fenc               查看当前文件的编码。
:set fileencoding       同上

在vimrc中set fileencoding=ucs-bom,utf-8,cp936，
vim会根据要打开的文件选择合适的编码。 
```

## 编程辅助
##### 1.一些按键
```
gd       跳转到局部变量的定义处；
gD       跳转到全局变量的定义处，从当前文件开头开始搜索；
g;       上一个修改过的地方；
g,       下一个修改过的地方；
[[       跳转到上一个函数块开始，需要有单独一行的{。
]]       跳转到下一个函数块开始，需要有单独一行的{。
[]       跳转到上一个函数块结束，需要有单独一行的}。
][       跳转到下一个函数块结束，需要有单独一行的}。
[{       跳转到当前块开始处；
]}       跳转到当前块结束处；
[/       跳转到当前注释块开始处；
]/       跳转到当前注释块结束处；
%        不仅能移动到匹配的(),{}或[]上，而且能在#if，#else， #endif之间跳跃。

ci', di', yi'      修改、剪切或复制'之间的内容。
ca', da', ya'      修改、剪切或复制'之间的内容，包含'。
ci", di", yi"      修改、剪切或复制"之间的内容。
ca", da", ya"      修改、剪切或复制"之间的内容，包含"。
ci(, di(, yi(      修改、剪切或复制()之间的内容。
ca(, da(, ya(      修改、剪切或复制()之间的内容，包含()。
ci[, di[, yi[      修改、剪切或复制[]之间的内容。
ca[, da[, ya[      修改、剪切或复制[]之间的内容，包含[]。
ci{, di{, yi{      修改、剪切或复制{}之间的内容。
ca{, da{, ya{      修改、剪切或复制{}之间的内容，包含{}。
ci<, di<, yi<      修改、剪切或复制<>之间的内容。
ca<, da<, ya<      修改、剪切或复制<>之间的内容，包含<>。
```

##### 2.Gtags
```
使用Gtags之前，你需要安装GNU Gtags。 然后在工程目录运行 gtags 。

:Gtags funcname      定位到 funcname 的定义处。
:Gtags -r funcname   查询 funcname被引用的地方。
:Gtags -s symbol     定位 symbol 出现的地方。
:Gtags -g string     Goto string 出现的地方。 :Gtags -gi string 忽略大小写。
:Gtags -f filename   显示 filename 中的函数列表。 如 :Gtags -f %   显示当前文件。
:Gtags -P pattern    显示路径中包含特定模式的文件。如 :Gtags -P .h$ 显示所有头文件
:Gtags -P /vm/       显示vm目录下的文件。
```

##### 3.编译
```
vim提供了:make来编译程序，默认调用的是make， 
如果你当前目录下有makefile，简单地:make即可。

如果程序有错，可以通过quickfix窗口查看错误
不过如果要正确定位错误，需要设置好errorformat，让vim识别错误信息。 如：

:setl efm=%A%f:%l:\ %m,%-Z%p^,%-C%.%#

%f表示文件名，%l表示行号， %m表示错误信息.
```

##### 4.快速修改窗口
```
其实是quickfix插件提供的功能， 对编译调试程序非常有用 :)

:copen     打开快速修改窗口。
:cclose    关闭快速修改窗口。

快速修改窗口在make程序时非常有用，当make之后：

:cl    在快速修改窗口中列出错误。
:cn    定位到下一个错误。
:cp    定位到上一个错误。
:cr    定位到第一个错误。
```

##### 5.折叠
```
zf         创建折叠的命令，可以在一个可视区域上使用该命令；
zd         删除当前行的折叠；
zD         删除当前行的折叠；
zfap       折叠光标所在的段；
zo         打开折叠的文本；
zc         收起折叠；
za         打开/关闭当前折叠；
zr         打开嵌套的折行；
zm         收起嵌套的折行；
zR (zO)    打开所有折行；
zM (zC)    收起所有折行；
zj         跳到下一个折叠处；
zk         跳到上一个折叠处；
zi         enable/disable fold;
```

## 小技巧
##### 1.计算器
```
C-r 2+2 =    (插入模式)光标处会插入计算结果
```

##### 2.忘记用 root 方式打开文件时的文件保存
```
:w !sudo tee %
```

##### 3.实时加密文本
```
ggVGg?     

解析：
      gg 把光标移动到 Vim 缓冲区的第一行，
      V 进入可视模式，
      G 把光标移动到缓冲区的最后一行。
      g? 使用 ROT13 对整个区域进行编码。
```

##### 4.比较两个文件的不同
```
$ vimdiff [文件1] [文件2]  比较两个文件的不同(终端命令)

vim命令:
① vim -o file1 file2    水平分割窗口，同时打开file1和file2
  vim -O file1 file2    垂直分割窗口，同时打开file1和file2

② :windo diffthis

③ :diffoff
```

##### 5.删除标记内部的文字
```
di[标记]   轻松的删除方括号或圆括号里的内容

di(        删除()内的文字
di[        删除[]内的文字
di"        删除""内的文字
```

##### 6.删除指定标记前的内容
```
dt[标记]   删除所有光标和标记之间的内容

dt;        删除光标到;之间的内容
dt.        删除光标到.之间的内容
```

##### 7.把 Vim 变为十六进制编辑器
```
:%!xxd     把文件转换为十六进制模式。
:%!xxd -r  恢复正常
```

##### 8.把光标下的文字置于屏幕中央
```
ZZ
```

##### 9.跳到上一个／下一个位置
```
Ctrl+o     跳到上一个修改的地方
Ctrl+i     跳到下一个修改的地方
```

##### 10.把当前文件转化为网页
```
:%TOhtml
```

##### 11.查找函数原型
```
n K       利用man，查找光标所在函数原型（一般2、3章）
```

##### 12.末行模式下执行shell命令
```
:!command    跳回终端界面执行shell命令
```
